# Querybinder

Querybinder generates Rust code from annotated SQL queries.

Working with SQL in statically typed languages is often tedious. You need to
explicitly bind values to parameters, and extract the resulting values for every
column with the right type. Querybinder can generate this boilerplate code from
a SQL file, based on a few minimal annotations.

**Vaporware warning**: This is a work in progress. It does not actually generate
any code yet right now.

## Example

Given the following input:

```sql
-- Look up a user by username.
-- @query get_user_by_name(name: str) -> Option<User>
select id /* :i64 */, name /* :str */, email /* :str */
from users
where name = :name;
```

When targeting Rust and the `sqlite` crate, would generate:

```rust
struct User {
    id: i64,
    name: String,
    email: String,
}

/// Look up a user by username.
pub fn get_user_by_name(connection: &Connection, name: &str) -> Result<Option<User>> {
    let mut statement = connection.prepare(
        r#"
        select id, name, email
        from users
        where name = :name;
        "#
    )?;
    statement.bind(1, name)?;
    match statement.next()? {
        State::Done => Ok(None),
        State::Row => {
            let result = User {
                id: statement.read(0)?,
                name: statement.read(1)?,
                email: statement.read(2)?,
            };
            Ok(Some(result))
        }
    }
}
```

## Testing

To fuzz the parser:

    cargo +nightly-2022-06-25 install cargo-fuzz --version 0.11.0
    cargo +nightly-2022-06-25 fuzz run parse

To run the golden tests:

    golden/run.py

To update golden tests, if a change is intentional:

    golden/run.py --rewrite-output

To run a particular golden test:

    golden/run.py golden/error/annotation_token_after_paren.test

## License

Querybinder is licensed under the [Apache 2.0][apache2] license. Output of the
program (code generated by Querybinder) is not covered by this license. Please
do not open an issue if you disagree with the choice of license.

[apache2]: https://www.apache.org/licenses/LICENSE-2.0
